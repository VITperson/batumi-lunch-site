# QA Checklist — Batumi Lunch Web

## Smoke сценарии
- [ ] Открыть `/menu`, проверить отображение недели, блюд, статуса окна заказов.
- [ ] Авторизоваться как customer (`customer@batumi.lunch`), пройти мастер `/order/new` (день → количество → адрес → подтверждение), убедиться в появлении заказа в `/account/orders`.
- [ ] Проверить защиту от дубликатов: повторно оформить заказ на тот же день — получить ответ 409 и ссылку на существующий заказ.
- [ ] Изменить количество заказа из `/orders/{id}`, убедиться в обновлении счётчика и статуса.
- [ ] Отменить заказ, убедиться в смене статуса на `cancelled_by_user` и отсутствии в списке активных.

## Admin
- [ ] Войти под `admin@batumi.lunch`, открыть `/admin` → `/admin/menu` и обновить блюдо. Проверить, что изменения видны на `/menu`.
- [ ] Загрузить фото меню, убедиться в появлении ссылки/изображения на `/menu`.
- [ ] Открыть/закрыть предзаказ следующей недели, проверить флаг в `/menu` и доступность даты в мастере заказа.
- [ ] На `/admin/reports` выбрать текущую неделю, проверить суммарные объёмы против ожидаемых значений.
- [ ] Отправить рассылку `/admin/broadcast`, убедиться в ответе API (`status=pending`).

## API
- [ ] `GET /healthz` → `{status: ok}`.
- [ ] `GET /readyz` → `ready` при доступности БД и Redis.
- [ ] `POST /orders` с невалидным днём → 400.
- [ ] `PATCH /orders/{id}` с `count=0` → 422 с описанием.
- [ ] `POST /orders/{id}/cancel` под другим пользователем → 403.
- [ ] `PUT /admin/menu/{day}` без токена → 401.
- [ ] `POST /admin/broadcasts` чаще одного раза в минуту → 429.

## Данные и миграция
- [ ] Запустить `scripts/migrate_json_to_db.py` дважды — убедиться, что данные не дублируются.
- [ ] Выполнить `scripts/seed_menu.py`, проверить наличие тестовых пользователей и меню.

## Регресс FSM бота → веб UI
- [ ] Адреса и телефоны сохраняются и подтягиваются автоматически при повторных заказах.
- [ ] Окно заказов учитывает `ORDER_CUTOFF_HOUR=10:00` (заказ текущего дня после дедлайна не создаётся).
- [ ] Антиспам (10 секунд) блокирует повторные заказы из UI (получить 422/400). 
- [ ] Статусы заказов (`new`, `cancelled`, `cancelled_by_user`) совпадают с ботом.

## Нефункциональные
- [ ] Линтеры (`make lint`, `npm run lint`) проходят без ошибок.
- [ ] Тесты (`make test`, `npm run build`) выполняются успешно.
- [ ] Docker-compose `make up` поднимает все сервисы, `make down` очищает.
